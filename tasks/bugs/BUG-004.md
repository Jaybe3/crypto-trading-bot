# BUG-004: learning.py filters by non-existent "applied_at" column on adaptations

**Severity:** CRITICAL
**Found:** 2026-02-05
**Found By:** Audit Layer 2 (Schema) + Layer 3 (Integration)
**Status:** FIXED

## Evidence
learning.py:397,418 filter with WHERE applied_at >= ? on adaptations table.
Column "applied_at" does not exist. Actual column is "timestamp".
Query will crash with sqlite3.OperationalError at runtime.

## Root Cause
Schema drift â€” code references old column name.

## Fix
1. src/analysis/learning.py line 397: Fixed WHERE clause
   - Old: WHERE applied_at >= ?
   - New: WHERE timestamp >= ?

2. src/analysis/learning.py line 418: Fixed WHERE clause
   - Old: WHERE applied_at >= ? AND applied_at < ?
   - New: WHERE timestamp >= ? AND timestamp < ?

Note: Line 170 uses "applied_at" as a Python variable name for tuple unpacking,
not as a SQL column reference. This is valid and left unchanged.

## Verification
- No SQL queries reference "applied_at" as a column name
- Python can import the module without error
- Full test suite passes (835 passed, 1 skipped)

## Fixed In
TBD - pending commit
