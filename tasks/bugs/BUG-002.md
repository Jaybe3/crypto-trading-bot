# BUG-002: learning.py queries non-existent "score" column from coin_scores

**Severity:** CRITICAL
**Found:** 2026-02-05
**Found By:** Audit Layer 2 (Schema) + Layer 3 (Integration)
**Status:** FIXED

## Evidence
learning.py:45 queries "score" column. coin_scores table has no "score" column.
Query will crash with sqlite3.OperationalError at runtime.

## Root Cause
Schema drift â€” code written for an older table schema that had a "score" column.

## Fix
1. src/analysis/learning.py line 45: Removed "score" from SELECT query
   - Old: SELECT coin, score, total_trades, win_rate, total_pnl
   - New: SELECT coin, total_trades, win_rate, total_pnl

2. src/analysis/learning.py line 63: Updated tuple unpacking
   - Old: for coin, score, trades, win_rate, pnl in coins:
   - New: for coin, trades, win_rate, pnl in coins:

3. src/analysis/learning.py line 65: Compute score from win_rate
   - Old: score = score or 50
   - New: score = int((win_rate or 0) * 100)

## Verification
- Python can import the module without error
- Query columns match actual schema
- Full test suite passes

## Fixed In
[commit hash to be filled after commit]
